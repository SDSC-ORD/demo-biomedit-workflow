prefixes:
  sphn: https://biomedit.ch/rdf/sphn-ontology/sphn#
  syn: https://github.com/synthetichealth/synthea/

sources:
  patients:
    access: patients.json
    referenceFormulation: jsonpath
    iterator: "$[*].entry[?(@.resource.resourceType=='Patient')]"
  organizations:
    access: patients.json
    referenceFormulation: jsonpath
    iterator: "$[*].entry[?(@.resource.resourceType=='Organization')]"
  encounters:
    access: patients.json
    referenceFormulation: jsonpath
    iterator: "$[*].entry[?(@.resource.resourceType=='Encounter')]"

mappings:
  patient:
    source:
      - patients
    s: $(fullUrl)
    po:
      - [a, sphn:SubjectPseudoIdentifier]
      - [sphn:hasIdentifier, $(resource.id)]

  organization:
    source:
      - organizations
    s: $(fullUrl)
    po:
      - [a, sphn:DataProviderInstitute]
      - [sphn:hasCode, $(resource.id)]

  encounter:
    source:
      - encounters
    s: $(fullUrl)
    po:
      - [a, sphn:HealthcareEncounter]
      - [sphn:hasIdentifier, $(resource.id)]
      - [sphn:hasStartDateTime, $(resource.period.start)]
      - [sphn:hasEndDateTime, $(resource.period.end)]
      - p: sphn:hasSubjectPseudoIdentifier
        o:
        - mapping: patient
          condition:
            function: equal
            parameters:
              - [str1, $(resource.subject.reference), s]
              - [str2, $(fullUrl)]
      - p: sphn:hasDataProviderInstitute
        o:
        - mapping: organization
          condition:
            function: equal
            parameters:
              - [str1, $(resource.serviceProvider.reference), s]
              - [str2, $(fullUrl), o]

